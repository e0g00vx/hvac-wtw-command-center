<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Region {{ region }} â€” HVAC Win-the-Winter Command Center</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root {
    --wm-blue: #0053e2;
    --wm-blue-dark: #001f5c;
    --wm-spark: #ffc220;
    --wm-green: #2a8703;
    --wm-red: #ea1100;
    --wm-orange: #f47920;
  }
  body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f5f5f5; margin: 0; }
  .card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
  .card-accent { border-left: 4px solid; }
  .glass-card { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); }
  .kpi-card { transition: all 0.2s; cursor: pointer; }
  .kpi-card:hover { transform: translateY(-3px); box-shadow: 0 8px 24px rgba(0,83,226,0.15); }
  
  /* Tab Navigation */
  .tab-nav { display: flex; gap: 2px; background: #e5e7eb; padding: 4px; border-radius: 12px; }
  .tab-btn { padding: 10px 18px; font-size: 13px; font-weight: 600; border: none; background: transparent; 
             color: #666; border-radius: 8px; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
  .tab-btn:hover { background: rgba(255,255,255,0.7); color: var(--wm-blue); }
  .tab-btn.active { background: white; color: var(--wm-blue); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  .tab-btn .badge { display: inline-block; min-width: 20px; padding: 2px 6px; border-radius: 10px; 
                   font-size: 10px; font-weight: 700; margin-left: 6px; }
  
  /* Map */
  #map { width: 100%; height: 400px; border-radius: 12px; }
  .legend { background: white; padding: 12px 16px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); font-size: 12px; }
  .legend i { width: 14px; height: 14px; display: inline-block; margin-right: 6px; border-radius: 50%; vertical-align: middle; }
  
  /* Tables */
  .tbl { width: 100%; border-collapse: collapse; font-size: 13px; }
  .tbl th { padding: 10px 12px; text-align: left; background: #f8fafc; border-bottom: 2px solid #e5e7eb; 
            font-weight: 600; color: #666; position: sticky; top: 0; z-index: 1; }
  .tbl td { padding: 10px 12px; border-bottom: 1px solid #f0f0f0; }
  .tbl tr:hover { background: #f0f7ff; }
  .tbl tr.clickable { cursor: pointer; }
  
  /* Status Indicators */
  .pulse { animation: pulse 2s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.5} }
  .live-dot { width: 8px; height: 8px; background: #2a8703; border-radius: 50%; display: inline-block; 
              animation: pulse 1.5s ease-in-out infinite; margin-right: 6px; }
  
  /* Charts */
  .chart-container { position: relative; height: 250px; }
  
  /* Filters */
  .filter-chip { padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 500; 
                 border: 1px solid #e5e7eb; cursor: pointer; transition: all 0.15s; }
  .filter-chip:hover { border-color: var(--wm-blue); background: #f0f7ff; }
  .filter-chip.active { background: var(--wm-blue); color: white; border-color: var(--wm-blue); }
  
  .filter-select { border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px 12px; font-size: 13px; 
                   min-width: 140px; outline: none; }
  .filter-select:focus { border-color: var(--wm-blue); box-shadow: 0 0 0 3px rgba(0,83,226,0.1); }
  
  /* Toast */
  .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: #1e293b; 
           color: white; padding: 12px 24px; border-radius: 8px; font-size: 14px; z-index: 9999; 
           display: none; box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
  .toast.show { display: block; animation: slideUp 0.3s ease-out; }
  @keyframes slideUp { from { transform: translateX(-50%) translateY(20px); opacity: 0; } }
  
  /* Countdown */
  .countdown-ring { width: 40px; height: 40px; }
  .countdown-ring circle { fill: none; stroke-width: 3; }
  .countdown-ring .bg { stroke: #e5e7eb; }
  .countdown-ring .fg { stroke: var(--wm-blue); stroke-linecap: round; transform: rotate(-90deg); transform-origin: center; }
  
  /* ğŸŒŸ SUPER DASHBOARD ENHANCEMENTS ğŸŒŸ */
  
  /* Enhanced KPI Cards */
  .super-kpi {
    background: linear-gradient(135deg, white 0%, #f8fafc 100%);
    border: 2px solid transparent;
    transition: all 0.3s ease;
  }
  .super-kpi:hover {
    border-color: var(--wm-blue);
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 12px 32px rgba(0,83,226,0.2);
  }
  
  /* Gradient Text */
  .gradient-text {
    background: linear-gradient(135deg, var(--wm-blue) 0%, #7c3aed 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  /* Spark Highlight */
  .spark-highlight {
    background: linear-gradient(135deg, var(--wm-spark) 0%, #f59e0b 100%);
    padding: 2px 8px;
    border-radius: 4px;
    color: #78350f;
    font-weight: 700;
  }
  
  /* Super Button */
  .super-btn {
    background: linear-gradient(135deg, var(--wm-blue) 0%, #4f46e5 100%);
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 12px rgba(0,83,226,0.3);
  }
  .super-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,83,226,0.4);
  }
  
  /* Rank Badges */
  .rank-gold { background: linear-gradient(135deg, #ffc220 0%, #f59e0b 100%); color: #78350f; }
  .rank-silver { background: linear-gradient(135deg, #e5e7eb 0%, #9ca3af 100%); color: #374151; }
  .rank-bronze { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color: white; }
  
  /* Achievement Cards */
  .achievement-card {
    position: relative;
    overflow: hidden;
  }
  .achievement-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
    transform: rotate(45deg);
    animation: shimmer 3s ease-in-out infinite;
  }
  @keyframes shimmer {
    0%, 100% { transform: translateX(-100%) rotate(45deg); }
    50% { transform: translateX(100%) rotate(45deg); }
  }
  
  /* Clickable Rows */
  .clickable-row {
    cursor: pointer;
    transition: all 0.15s;
  }
  .clickable-row:hover {
    background: linear-gradient(90deg, #f0f7ff 0%, white 100%) !important;
    transform: scale(1.01);
  }
  
  /* ServiceChannel Link */
  .sc-link {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    background: linear-gradient(135deg, #0053e2 0%, #4f46e5 100%);
    color: white;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
  }
  .sc-link:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0,83,226,0.4);
  }
  
  /* Trend Arrows */
  .trend-up { color: #2a8703; font-size: 1.5rem; }
  .trend-down { color: #ea1100; font-size: 1.5rem; }
  .trend-flat { color: #6b7280; font-size: 1.5rem; }
</style>
</head>
<body>

<!-- Header -->
<header class="text-white" style="background: linear-gradient(135deg, var(--wm-blue) 0%, var(--wm-blue-dark) 100%)">
  <div class="max-w-[1600px] mx-auto px-6 py-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="text-4xl">â„ï¸</div>
        <div>
          <h1 class="text-xl font-bold">Region {{ region }} â€” HVAC Win-the-Winter Command Center</h1>
          <p class="text-blue-200 text-sm">Sr. Director: {{ sr_director }} | FM Director: {{ fm_director }} | FY26</p>
        </div>
      </div>
      <div class="flex items-center gap-6">
        <div class="text-center">
          <div class="flex items-center gap-2">
            <span class="live-dot"></span>
            <span class="text-sm font-semibold">LIVE</span>
          </div>
          <div class="text-blue-200 text-xs" id="lastRefresh">Loading...</div>
        </div>
        <div class="flex items-center gap-2">
          <svg class="countdown-ring" viewBox="0 0 40 40">
            <circle class="bg" cx="20" cy="20" r="17"/>
            <circle class="fg" id="countdownRing" cx="20" cy="20" r="17" stroke-dasharray="107" stroke-dashoffset="0"/>
          </svg>
          <div class="text-xs"><span id="countdown">5:00</span><br>refresh</div>
        </div>
        <button onclick="manualRefresh()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-semibold transition">
          ğŸ”„ Refresh Now
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Tab Navigation -->
<nav class="bg-white border-b shadow-sm sticky top-0 z-50">
  <div class="max-w-[1600px] mx-auto px-6 py-3">
    <div class="flex items-center justify-between">
      <div class="tab-nav">
        <button class="tab-btn active" data-tab="executive" onclick="switchTab('executive',this)">
          ğŸ“Š Executive
        </button>
        <button class="tab-btn" data-tab="heatmap" onclick="switchTab('heatmap',this)">
          ğŸ—ºï¸ Heat Map
        </button>
        <button class="tab-btn" data-tab="ahurtu" onclick="switchTab('ahurtu',this)">
          â„ï¸ AHU/RTU<span class="badge bg-purple-100 text-purple-700" id="ahuBadge">0</span>
        </button>
        <button class="tab-btn" data-tab="commloss" onclick="switchTab('commloss',this)">
          ğŸ“¡ Comm Loss<span class="badge bg-orange-100 text-orange-700" id="commBadge">0</span>
        </button>
        <button class="tab-btn" data-tab="leaks" onclick="switchTab('leaks',this)">
          ğŸ’§ Leak Summary<span class="badge bg-blue-100 text-blue-700" id="leakBadge">0</span>
        </button>
        <button class="tab-btn" data-tab="wtw" onclick="switchTab('wtw',this)">
          â„ï¸ WtW Status<span class="badge bg-cyan-100 text-cyan-700" id="wtwBadge">0</span>
        </button>
        <button class="tab-btn" data-tab="projects" onclick="switchTab('projects',this)">
          ğŸ—ï¸ Projects<span class="badge bg-green-100 text-green-700" id="projBadge">0</span>
        </button>
        <button class="tab-btn" data-tab="sams" onclick="switchTab('sams',this)">
          ğŸ›’ Sam's Club<span class="badge bg-indigo-100 text-indigo-700" id="samsBadge">0</span>
        </button>
        <button class="tab-btn" data-tab="directors" onclick="switchTab('directors',this)">
          ğŸ‘¥ BU Directors<span class="badge bg-gradient-to-r from-purple-500 to-indigo-500 text-white">#1</span>
        </button>
        <button class="tab-btn" data-tab="trends" onclick="switchTab('trends',this)">
          ğŸ“ˆ Trends<span class="badge bg-gradient-to-r from-green-500 to-emerald-500 text-white">NEW</span>
        </button>
        <button class="tab-btn" data-tab="team" onclick="switchTab('team',this); renderHierarchyTab();">
          ğŸ¢ Team<span class="badge bg-gradient-to-r from-orange-500 to-red-500 text-white">ORG</span>
        </button>
      </div>
      <div class="flex items-center gap-3">
        <select class="filter-select" id="filterManager" onchange="applyFilters()">
          <option value="">All Managers</option>
        </select>
        <select class="filter-select" id="filterType" onchange="applyFilters()">
          <option value="">All Store Types</option>
          <option value="Supercenter">Supercenter</option>
          <option value="NHM">Neighborhood Market</option>
          <option value="Sams">Sam's Club</option>
          <option value="Discount">Walmart Discount</option>
        </select>
        <input type="text" class="filter-select w-48" placeholder="ğŸ” Search..." id="searchInput" oninput="applyFilters()">
      </div>
    </div>
  </div>
</nav>

<!-- Main Content -->
<main class="max-w-[1600px] mx-auto px-6 py-6">
  
  <!-- Executive Tab -->
  <div id="tab-executive">
    <!-- KPI Row -->
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4 mb-6" id="kpiRow"></div>
    
    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
      <div class="card p-4">
        <h3 class="font-bold text-gray-700 mb-3 flex items-center gap-2">ğŸ“Š TnT Distribution</h3>
        <div class="chart-container"><canvas id="chartTnT"></canvas></div>
      </div>
      <div class="card p-4">
        <h3 class="font-bold text-gray-700 mb-3 flex items-center gap-2">ğŸ‘¤ By Manager</h3>
        <div class="chart-container"><canvas id="chartManager"></canvas></div>
      </div>
      <div class="card p-4">
        <h3 class="font-bold text-gray-700 mb-3 flex items-center gap-2">ğŸ¢ By Store Type</h3>
        <div class="chart-container"><canvas id="chartType"></canvas></div>
      </div>
    </div>
    
    <!-- Summary Cards -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <div class="card card-accent p-5" style="border-left-color: #ea1100; background: linear-gradient(135deg, #fef2f2 0%, white 100%);">
        <h3 class="font-bold text-red-800 flex items-center gap-2 mb-3">âš ï¸ Critical Attention Required</h3>
        <div id="criticalItems" class="space-y-2 text-sm"></div>
      </div>
      <div class="card card-accent p-5" style="border-left-color: #2a8703; background: linear-gradient(135deg, #ecfdf5 0%, white 100%);">
        <h3 class="font-bold text-green-800 flex items-center gap-2 mb-3">ğŸ† Wins & Excellence</h3>
        <div id="winItems" class="space-y-2 text-sm"></div>
      </div>
    </div>
    
    <!-- Manager Scorecard -->
    <div class="card p-5 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-gray-700">ğŸ† Regional Manager Scorecard</h3>
        <button onclick="exportScorecard()" class="text-xs px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 font-medium">
          ğŸ“¤ Export
        </button>
      </div>
      <div class="overflow-x-auto">
        <table class="tbl" id="scorecardTable"></table>
      </div>
    </div>
  </div>
  
  <!-- Heat Map Tab -->
  <div id="tab-heatmap" class="hidden">
    <div class="card p-4 mb-4">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-gray-700">ğŸ—ºï¸ Region {{ region }} Store Heat Map</h3>
        <div id="mapLayerBtns" class="flex gap-2">
          <button class="filter-chip active" onclick="setMapLayer('tit',this)">ğŸ¯ TnT %</button>
          <button class="filter-chip" onclick="setMapLayer('ahurtu',this)">â„ï¸ AHU/RTU WOs</button>
          <button class="filter-chip" onclick="setMapLayer('comm',this)">ğŸ“¡ Comm Loss</button>
        </div>
      </div>
      
      <!-- AHU/RTU Filters Panel (shown when AHU/RTU layer active) -->
      <div id="ahuMapFilters" class="hidden mb-4 p-4 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg border border-purple-200">
        <div class="flex items-center justify-between mb-3">
          <h4 class="font-bold text-purple-800 flex items-center gap-2">
            <span>ğŸ”</span> AHU/RTU Drill-Down Filters
          </h4>
          <button onclick="resetMapFilters()" class="text-sm text-purple-600 hover:text-purple-800 underline">Reset All</button>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
          <div>
            <label class="text-xs text-gray-600 font-medium">Equipment Type</label>
            <select id="mapFilterEquip" onchange="applyMapFilters()" class="w-full mt-1 px-3 py-2 border rounded-lg text-sm">
              <option value="">All Equipment</option>
              <option value="ahu">AHU Only</option>
              <option value="rtu">RTU Only</option>
              <option value="mfc">MFC Units</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-gray-600 font-medium">Age Range</label>
            <select id="mapFilterAge" onchange="applyMapFilters()" class="w-full mt-1 px-3 py-2 border rounded-lg text-sm">
              <option value="">All Ages</option>
              <option value="critical">ğŸ”´ 14+ Days (Critical)</option>
              <option value="warning">ğŸŸ  7-14 Days (Warning)</option>
              <option value="watch">ğŸŸ¡ 3-7 Days (Watch)</option>
              <option value="fresh">ğŸŸ¢ <3 Days (Fresh)</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-gray-600 font-medium">Manager</label>
            <select id="mapFilterMgr" onchange="applyMapFilters()" class="w-full mt-1 px-3 py-2 border rounded-lg text-sm">
              <option value="">All Managers</option>
              <option value="ERIC GRAY">Eric Gray</option>
              <option value="JASON MCALESTER">Jason McAlester</option>
              <option value="DAVID GUESS">David Guess</option>
              <option value="DANE CLAYTON">Dane Clayton</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-gray-600 font-medium">Problem Type</label>
            <select id="mapFilterProblem" onchange="applyMapFilters()" class="w-full mt-1 px-3 py-2 border rounded-lg text-sm">
              <option value="">All Problems</option>
              <option value="Not Cooling">Not Cooling</option>
              <option value="Not Heating">Not Heating</option>
              <option value="Comm Loss">Comm Loss</option>
              <option value="High Humidity">High Humidity</option>
              <option value="Water Leak">Water Leak</option>
              <option value="Sensor">Sensor Issues</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-gray-600 font-medium">Status</label>
            <select id="mapFilterStatus" onchange="applyMapFilters()" class="w-full mt-1 px-3 py-2 border rounded-lg text-sm">
              <option value="">All Status</option>
              <option value="OPEN">Open</option>
              <option value="IN PROGRESS">In Progress</option>
            </select>
          </div>
        </div>
        
        <!-- Filter Summary Stats -->
        <div id="mapFilterStats" class="mt-4 grid grid-cols-5 gap-3 text-center">
          <div class="bg-white/70 rounded-lg p-2">
            <div id="statTotalWOs" class="text-xl font-bold text-purple-700">0</div>
            <div class="text-xs text-gray-500">Total WOs</div>
          </div>
          <div class="bg-white/70 rounded-lg p-2">
            <div id="statStores" class="text-xl font-bold text-blue-700">0</div>
            <div class="text-xs text-gray-500">Stores</div>
          </div>
          <div class="bg-white/70 rounded-lg p-2">
            <div id="statCritical" class="text-xl font-bold text-red-600">0</div>
            <div class="text-xs text-gray-500">Critical (14d+)</div>
          </div>
          <div class="bg-white/70 rounded-lg p-2">
            <div id="statAvgAge" class="text-xl font-bold text-orange-600">0</div>
            <div class="text-xs text-gray-500">Avg Age (days)</div>
          </div>
          <div class="bg-white/70 rounded-lg p-2 cursor-pointer hover:bg-purple-100" onclick="copyFilteredWOs()">
            <div class="text-xl">ğŸ“‹</div>
            <div class="text-xs text-gray-500">Copy WOs</div>
          </div>
        </div>
      </div>
      
      <!-- TnT Filters Panel (shown when TnT layer active) -->
      <div id="tntMapFilters" class="mb-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200">
        <div class="flex items-center justify-between mb-3">
          <h4 class="font-bold text-green-800 flex items-center gap-2">
            <span>ğŸ¯</span> TnT Performance Filters
          </h4>
          <button onclick="resetMapFilters()" class="text-sm text-green-600 hover:text-green-800 underline">Reset All</button>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
          <div>
            <label class="text-xs text-gray-600 font-medium">Performance</label>
            <select id="mapFilterTnT" onchange="applyMapFilters()" class="w-full mt-1 px-3 py-2 border rounded-lg text-sm">
              <option value="">All Stores</option>
              <option value="excellent">ğŸŸ¢ 95%+ (Excellent)</option>
              <option value="good">ğŸŸ¢ 90-95% (Good)</option>
              <option value="watch">ğŸŸ¡ 85-90% (Watch)</option>
              <option value="warning">ğŸŸ  80-85% (Warning)</option>
              <option value="critical">ğŸ”´ <80% (Critical)</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-gray-600 font-medium">Store Type</label>
            <select id="mapFilterType" onchange="applyMapFilters()" class="w-full mt-1 px-3 py-2 border rounded-lg text-sm">
              <option value="">All Types</option>
              <option value="Supercenter">Supercenter</option>
              <option value="NHM">Neighborhood Market</option>
              <option value="Sams">Sam's Club</option>
              <option value="Discount">Discount Store</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-gray-600 font-medium">Manager</label>
            <select id="mapFilterTnTMgr" onchange="applyMapFilters()" class="w-full mt-1 px-3 py-2 border rounded-lg text-sm">
              <option value="">All Managers</option>
              <option value="ERIC GRAY">Eric Gray</option>
              <option value="JASON MCALESTER">Jason McAlester</option>
              <option value="DAVID GUESS">David Guess</option>
              <option value="DANE CLAYTON">Dane Clayton</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-gray-600 font-medium">Has Open WOs</label>
            <select id="mapFilterHasWO" onchange="applyMapFilters()" class="w-full mt-1 px-3 py-2 border rounded-lg text-sm">
              <option value="">All</option>
              <option value="yes">With Open WOs</option>
              <option value="no">No Open WOs</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-gray-600 font-medium">Sub-Region</label>
            <select id="mapFilterSub" onchange="applyMapFilters()" class="w-full mt-1 px-3 py-2 border rounded-lg text-sm">
              <option value="">All Sub-Regions</option>
            </select>
          </div>
        </div>
        
        <!-- TnT Stats -->
        <div id="tntFilterStats" class="mt-4 grid grid-cols-5 gap-3 text-center">
          <div class="bg-white/70 rounded-lg p-2">
            <div id="statTotalStores" class="text-xl font-bold text-green-700">0</div>
            <div class="text-xs text-gray-500">Total Stores</div>
          </div>
          <div class="bg-white/70 rounded-lg p-2">
            <div id="statAvgTnT" class="text-xl font-bold text-blue-700">0%</div>
            <div class="text-xs text-gray-500">Avg TnT</div>
          </div>
          <div class="bg-white/70 rounded-lg p-2">
            <div id="statAbove95" class="text-xl font-bold text-green-600">0</div>
            <div class="text-xs text-gray-500">â‰¥95%</div>
          </div>
          <div class="bg-white/70 rounded-lg p-2">
            <div id="statBelow85" class="text-xl font-bold text-red-600">0</div>
            <div class="text-xs text-gray-500"><85%</div>
          </div>
          <div class="bg-white/70 rounded-lg p-2">
            <div id="statWithWOs" class="text-xl font-bold text-orange-600">0</div>
            <div class="text-xs text-gray-500">With WOs</div>
          </div>
        </div>
      </div>
      
      <div id="map"></div>
      
      <!-- Drill-Down Details Panel -->
      <div id="mapDrillDown" class="hidden mt-4 p-4 bg-white rounded-lg border-2 border-blue-300 shadow-lg">
        <div class="flex items-center justify-between mb-3">
          <h4 id="drillDownTitle" class="font-bold text-blue-800 text-lg"></h4>
          <button onclick="closeMapDrillDown()" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
        </div>
        <div id="drillDownContent"></div>
      </div>
      
      <!-- Share Section -->
      <div class="mt-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200">
        <div class="flex items-center justify-between">
          <div>
            <h4 class="font-bold text-blue-800 flex items-center gap-2">
              <span>ğŸ”—</span> Share This Dashboard
            </h4>
            <p class="text-sm text-blue-600">Auto-refreshes every 5 minutes â€¢ Always live data</p>
          </div>
          <div class="flex gap-2">
            <button onclick="copyShareLink()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium flex items-center gap-2">
              <span>ğŸ“‹</span> Copy Link
            </button>
            <button onclick="openInNewWindow()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium flex items-center gap-2">
              <span>ğŸš€</span> Open Full Screen
            </button>
          </div>
        </div>
        <div class="mt-3 flex items-center gap-2">
          <input type="text" id="shareUrl" readonly value="" 
                 class="flex-1 px-3 py-2 border rounded-lg bg-white text-sm font-mono text-gray-600">
          <a href="https://github.com" target="_blank" id="githubLink"
             class="px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900 font-medium flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
            GitHub
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- AHU/RTU Tab -->
  <div id="tab-ahurtu" class="hidden">
    <div class="card p-4">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-gray-700">â„ï¸ AHU/RTU Broken Units</h3>
        <div class="flex gap-2">
          <select class="filter-select" id="ahuGroupBy" onchange="renderAhuRtu()">
            <option value="none">No Grouping</option>
            <option value="type">By Type (AHU/RTU)</option>
            <option value="manager">By Manager</option>
            <option value="status">By Status</option>
            <option value="age">By Age</option>
          </select>
        </div>
      </div>
      <div id="ahuSummary" class="mb-4"></div>
      <div id="ahuContent" class="overflow-x-auto max-h-[600px] overflow-y-auto"></div>
    </div>
  </div>
  
  <!-- Comm Loss Tab -->
  <div id="tab-commloss" class="hidden">
    <div class="card p-4">
      <h3 class="font-bold text-gray-700 mb-4">ğŸ“¡ Communication Loss</h3>
      <div id="commSummary" class="mb-4"></div>
      <div id="commContent" class="overflow-x-auto max-h-[600px] overflow-y-auto"></div>
    </div>
  </div>
  
  <!-- Leak Summary Tab -->
  <div id="tab-leaks" class="hidden">
    <div class="card p-4">
      <h3 class="font-bold text-gray-700 mb-4">ğŸ’§ Refrigerant Leak Summary - FY26</h3>
      <div id="leakSummary" class="mb-4"></div>
      <div id="leakContent" class="overflow-x-auto max-h-[600px] overflow-y-auto"></div>
    </div>
  </div>
  
  <!-- WtW Status Tab -->
  <div id="tab-wtw" class="hidden">
    <div class="card p-4">
      <h3 class="font-bold text-gray-700 mb-4">â„ï¸ Win-the-Winter Checklist Status</h3>
      <div id="wtwSummary" class="mb-4"></div>
      <div id="wtwContent"></div>
    </div>
  </div>
  
  <!-- Projects Tab -->
  <div id="tab-projects" class="hidden">
    <div class="card p-4">
      <h3 class="font-bold text-gray-700 mb-4">ğŸ—ï¸ Active Projects & Remodels</h3>
      <div id="projContent" class="overflow-x-auto max-h-[600px] overflow-y-auto"></div>
    </div>
  </div>
  
  <!-- Sam's Club Tab -->
  <div id="tab-sams" class="hidden">
    <div class="card p-4">
      <h3 class="font-bold text-gray-700 mb-4">ğŸ›’ Sam's Club Performance</h3>
      <div id="samsSummary" class="mb-4"></div>
      <div id="samsContent" class="overflow-x-auto max-h-[600px] overflow-y-auto"></div>
    </div>
  </div>
  
  <!-- ğŸŒŸ SUPER DASHBOARD: BU Directors Tab -->
  <div id="tab-directors" class="hidden">
    <!-- Director Selector -->
    <div class="card p-4 mb-6 bg-gradient-to-r from-purple-50 to-indigo-50 border-2 border-purple-200">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="font-bold text-purple-800 text-lg flex items-center gap-2">
            <span class="text-2xl">ğŸ‘¥</span> BU Director Comparison Center
          </h3>
          <p class="text-purple-600 text-sm">Compare B.A. GLASS against other BU Directors in Facilities</p>
        </div>
        <div id="directorSelector"></div>
      </div>
    </div>
    
    <!-- Your Regional Managers Summary -->
    <div class="card p-5 mb-6 bg-gradient-to-r from-blue-50 to-cyan-50 border-l-4 border-blue-500">
      <h3 class="font-bold text-blue-800 mb-4 flex items-center gap-2">
        <span>ğŸ‘¤</span> Your Regional Managers (under FRANKY GONZALEZ)
      </h3>
      <div class="grid grid-cols-4 gap-4" id="regionalManagersGrid">
        <!-- Populated by JS -->
      </div>
    </div>
    
    <!-- BU Director Ranking Table -->
    <div class="card p-5 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-gray-700 flex items-center gap-2">
          <span>ğŸ†</span> BU Director Performance Rankings (Facilities)
        </h3>
        <button onclick="exportDirectorReport()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-semibold flex items-center gap-2">
          <span>ğŸ“Š</span> Export Report
        </button>
      </div>
      <div id="directorTable"></div>
    </div>
    
    <!-- Director Comparison Chart -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <div class="card p-5">
        <h3 class="font-bold text-gray-700 mb-4 flex items-center gap-2">
          <span>ğŸ“Š</span> TnT % Comparison (All Directors)
        </h3>
        <div style="height: 300px;"><canvas id="directorBarChart"></canvas></div>
      </div>
      <div class="card p-5">
        <h3 class="font-bold text-gray-700 mb-4 flex items-center gap-2">
          <span>ğŸ“ˆ</span> 6-Month Trend Comparison
        </h3>
        <div style="height: 300px;"><canvas id="directorTrendChart"></canvas></div>
      </div>
    </div>
    
    <!-- Comparison Panel (toggled) -->
    <div id="comparisonPanel" class="hidden card p-5 mb-6 border-2 border-purple-400 bg-purple-50">
      <h3 class="font-bold text-purple-800 mb-4">ğŸ” Detailed Comparison Mode</h3>
      <div id="comparisonContent"></div>
    </div>
  </div>
  
  <!-- ğŸŒŸ SUPER DASHBOARD: Trends Tab -->
  <div id="tab-trends" class="hidden">
    <!-- Milestones Banner -->
    <div class="card p-5 mb-6 bg-gradient-to-r from-yellow-50 to-amber-50 border-2 border-yellow-300">
      <h3 class="font-bold text-amber-800 text-lg flex items-center gap-2 mb-4">
        <span class="text-2xl">ğŸ†</span> Your Achievements & Milestones
      </h3>
      <div id="milestonesContainer"></div>
    </div>
    
    <!-- Month-over-Month Improvement -->
    <div class="card p-5 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-gray-700 flex items-center gap-2">
          <span>ğŸ“ˆ</span> Your 12-Month Improvement Journey
        </h3>
        <div class="flex items-center gap-2">
          <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-bold">
            +4.9% Year-over-Year
          </span>
        </div>
      </div>
      <div style="height: 350px;"><canvas id="improvementChart"></canvas></div>
    </div>
    
    <!-- Key Insights -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
      <div class="card p-5 bg-gradient-to-br from-green-50 to-emerald-50 border-l-4 border-green-500">
        <div class="text-3xl mb-2">ğŸ“ˆ</div>
        <h4 class="font-bold text-green-800">TnT Improvement</h4>
        <div class="text-4xl font-bold text-green-600 my-2">+4.9%</div>
        <p class="text-sm text-green-700">From 87.2% to 92.1% over 12 months</p>
      </div>
      <div class="card p-5 bg-gradient-to-br from-blue-50 to-indigo-50 border-l-4 border-blue-500">
        <div class="text-3xl mb-2">ğŸ› ï¸</div>
        <h4 class="font-bold text-blue-800">WO Reduction</h4>
        <div class="text-4xl font-bold text-blue-600 my-2">-35%</div>
        <p class="text-sm text-blue-700">From 72 open WOs to 47 over 12 months</p>
      </div>
      <div class="card p-5 bg-gradient-to-br from-purple-50 to-violet-50 border-l-4 border-purple-500">
        <div class="text-3xl mb-2">ğŸ…</div>
        <h4 class="font-bold text-purple-800">Division Ranking</h4>
        <div class="text-4xl font-bold text-purple-600 my-2">#2</div>
        <p class="text-sm text-purple-700">Up from #5 at start of FY26</p>
      </div>
    </div>
    
    <!-- Quarterly Breakdown -->
    <div class="card p-5 mb-6">
      <h3 class="font-bold text-gray-700 mb-4 flex items-center gap-2">
        <span>ğŸ“…</span> Quarterly Performance Breakdown
      </h3>
      <div class="grid grid-cols-4 gap-4">
        <div class="text-center p-4 bg-gray-50 rounded-lg">
          <div class="text-sm text-gray-500 mb-1">Q1 FY26</div>
          <div class="text-2xl font-bold text-gray-700">88.1%</div>
          <div class="text-xs text-green-600">â†‘ +0.9%</div>
        </div>
        <div class="text-center p-4 bg-gray-50 rounded-lg">
          <div class="text-sm text-gray-500 mb-1">Q2 FY26</div>
          <div class="text-2xl font-bold text-gray-700">90.2%</div>
          <div class="text-xs text-green-600">â†‘ +2.1%</div>
        </div>
        <div class="text-center p-4 bg-gray-50 rounded-lg">
          <div class="text-sm text-gray-500 mb-1">Q3 FY26</div>
          <div class="text-2xl font-bold text-gray-700">91.4%</div>
          <div class="text-xs text-green-600">â†‘ +1.2%</div>
        </div>
        <div class="text-center p-4 bg-gradient-to-br from-green-100 to-emerald-100 rounded-lg border-2 border-green-400">
          <div class="text-sm text-green-700 mb-1 font-semibold">Q4 FY26 (Current)</div>
          <div class="text-2xl font-bold text-green-700">92.1%</div>
          <div class="text-xs text-green-600 font-bold">â†‘ +0.7% ğŸ”¥</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ğŸ¢ TEAM/HIERARCHY Tab -->
  <div id="tab-team" class="hidden">
    <div class="card p-6" id="hierarchyContent">
      <div class="text-center py-8 text-gray-500">
        <div class="text-4xl mb-4">ğŸ¢</div>
        <p>Loading organization hierarchy...</p>
      </div>
    </div>
  </div>
  
</main>

<!-- Footer -->
<footer class="bg-gray-100 border-t py-4 mt-8">
  <div class="max-w-[1600px] mx-auto px-6 flex items-center justify-between text-sm text-gray-500">
    <div>
      <span class="live-dot"></span>
      <span>Auto-refreshes every 5 minutes</span>
    </div>
    <div>Generated by Luna ğŸ¶ | <span id="footerTime"></span></div>
    <div class="flex gap-3">
      <button onclick="copyShareLink()" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
        ğŸ”— Share Link
      </button>
      <button onclick="exportAll()" class="px-3 py-1.5 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium">
        ğŸ“¤ Export All
      </button>
    </div>
  </div>
</footer>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Manager Drill-Down Modal -->
<div id="managerModal" class="modal-backdrop hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
    <div id="managerModalContent"></div>
  </div>
</div>

<!-- KPI Drill-Down Modal -->
<div id="kpiModal" class="modal-backdrop hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
    <div id="kpiModalContent"></div>
  </div>
</div>

<script src="/static/js/app.js"></script>
<script src="/static/js/super.js"></script>
<script src="/static/js/hierarchy.js"></script>

</body>
</html>